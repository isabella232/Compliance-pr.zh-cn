---
title: Microsoft 365中的SharePoint和OneDrive数据恢复能力
description: 本文概述了 Microsoft 365 中的 SharePoint 和 OneDrive 数据恢复能力。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
f1.keywords:
- NOCSH
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: c267551f26b4dd96e3762b0edc2942a3cb22eb5c
ms.sourcegitcommit: 024137a15ab23d26cac5ec14c36f3577fd8a0cc4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/01/2021
ms.locfileid: "51496773"
---
# <a name="sharepoint-and-onedrive-data-resiliency-in-microsoft-365"></a><span data-ttu-id="20b96-103">Microsoft 365中的SharePoint和OneDrive数据恢复能力</span><span class="sxs-lookup"><span data-stu-id="20b96-103">SharePoint and OneDrive data resiliency in Microsoft 365</span></span>

<span data-ttu-id="20b96-104">在 Microsoft 365 中，OneDrive 基于 SharePoint 文件平台构建。</span><span class="sxs-lookup"><span data-stu-id="20b96-104">Within Microsoft 365, OneDrive is built on top of the SharePoint file platform.</span></span> <span data-ttu-id="20b96-105">本文仅将 SharePoint 用于引用这两种产品。</span><span class="sxs-lookup"><span data-stu-id="20b96-105">In this article, only SharePoint will be used to refer to both products.</span></span> <span data-ttu-id="20b96-106">本文的内容与 Microsoft 365 相关，不适用于消费者服务。</span><span class="sxs-lookup"><span data-stu-id="20b96-106">The contents of this article are relevant to Microsoft 365 and do not apply to consumer services.</span></span>

<span data-ttu-id="20b96-107">SharePoint 的核心内容存储包含两种主要资产：</span><span class="sxs-lookup"><span data-stu-id="20b96-107">There are two primary assets that make up the core content storage of SharePoint:</span></span>

- <span data-ttu-id="20b96-108">**元数据**：有关每个文件的元数据存储在 Azure SQL 数据库中。</span><span class="sxs-lookup"><span data-stu-id="20b96-108">**Metadata**: Metadata about each file is stored in Azure SQL Database.</span></span> <span data-ttu-id="20b96-109">Azure SQL提供了 SharePoint 使用的完整业务连续性情景，本文稍后将介绍详细信息。</span><span class="sxs-lookup"><span data-stu-id="20b96-109">Azure SQL offers a complete business continuity story that SharePoint uses and details are covered later in this article.</span></span>
- <span data-ttu-id="20b96-110">**Blob 存储**：上传到 SharePoint 的用户内容存储在 Azure 存储中。</span><span class="sxs-lookup"><span data-stu-id="20b96-110">**Blob storage**: User content that is uploaded into SharePoint is stored in Azure Storage.</span></span> <span data-ttu-id="20b96-111">SharePoint 已基于 Azure 存储构建了一个自定义复原计划，以确保几乎实时复制用户内容和真正处于活动状态/活动的系统。</span><span class="sxs-lookup"><span data-stu-id="20b96-111">SharePoint has built a custom resiliency plan on top of Azure Storage to ensure near real-time duplication of user content and a truly active/active system.</span></span>

<span data-ttu-id="20b96-112">用于确保数据恢复的完整控件集在更多部分中进行了说明。</span><span class="sxs-lookup"><span data-stu-id="20b96-112">The complete set of controls to ensure data resiliency is explained in further sections.</span></span>

## <a name="blob-storage-resilience"></a><span data-ttu-id="20b96-113">Blob 存储恢复</span><span class="sxs-lookup"><span data-stu-id="20b96-113">Blob storage resilience</span></span>

<span data-ttu-id="20b96-114">SharePoint 具有一个自定义解决方案，用于存储 Azure 存储中的客户数据。</span><span class="sxs-lookup"><span data-stu-id="20b96-114">SharePoint has a custom-built solution for storage of customer data in Azure Storage.</span></span> <span data-ttu-id="20b96-115">每个文件同时写入主和辅助数据中心区域。</span><span class="sxs-lookup"><span data-stu-id="20b96-115">Every file is simultaneously written into both a primary and a secondary datacenter region.</span></span> <span data-ttu-id="20b96-116">如果写入任一 Azure 区域失败，文件保存将失败。</span><span class="sxs-lookup"><span data-stu-id="20b96-116">If writes to either Azure region fail, the file save will fail.</span></span> <span data-ttu-id="20b96-117">将内容写入 Azure 存储后，校验和会与元数据分开存储，并用于确保所有未来读取过程中提交写入的内容与发送到 SharePoint 的原始文件相同。</span><span class="sxs-lookup"><span data-stu-id="20b96-117">After the contents are written into Azure Storage, checksums are stored separately with metadata, and are used to ensure that the committed write is identical to the original file sent to SharePoint during all future reads.</span></span> <span data-ttu-id="20b96-118">在所有工作流中使用相同的技术，以防止应发生任何损坏的传播。</span><span class="sxs-lookup"><span data-stu-id="20b96-118">This same technique is used in all workflows to prevent propagation of any corruption that should occur.</span></span> <span data-ttu-id="20b96-119">在每个区域内，Azure 本地冗余存储 (LRS) 提供了高级别的可靠性。</span><span class="sxs-lookup"><span data-stu-id="20b96-119">Within each region, Azure Locally Redundant Storage (LRS) provides a high level of reliability.</span></span> <span data-ttu-id="20b96-120">有关详细信息， [请参阅 Azure 存储冗余](/azure/storage/common/storage-redundancy-lrs) 文章。</span><span class="sxs-lookup"><span data-stu-id="20b96-120">See the [Azure Storage redundancy](/azure/storage/common/storage-redundancy-lrs) article for details.</span></span>

<span data-ttu-id="20b96-121">SharePoint 使用Append-Only存储。</span><span class="sxs-lookup"><span data-stu-id="20b96-121">SharePoint uses Append-Only storage.</span></span> <span data-ttu-id="20b96-122">此过程可确保在初始保存后文件不会更改或损坏，但通过使用产品内版本控制，可以检索任何以前版本的文件内容。</span><span class="sxs-lookup"><span data-stu-id="20b96-122">This process ensures that files cannot be changed or corrupted after an initial save, but also by using in-product versioning, any previous version of the file contents can be retrieved.</span></span>

![Blob 存储恢复](../media/assurance-blob-storage-resiliency-diagram.png)

<span data-ttu-id="20b96-124">任一数据中心中的 SharePoint 环境都可以访问两个 Azure 区域的存储容器。</span><span class="sxs-lookup"><span data-stu-id="20b96-124">SharePoint environments in either datacenter can access storage containers in both Azure regions.</span></span> <span data-ttu-id="20b96-125">出于性能原因，始终首选同一本地数据中心中的存储容器，但是，未在所需阈值内查看结果的读取请求将具有从远程数据中心请求的相同内容，以确保数据始终可用。</span><span class="sxs-lookup"><span data-stu-id="20b96-125">For performance reasons the storage container in the same local datacenter is always preferred, however, read requests that do not see results within a desired threshold will have the same content requested from the remote datacenter to ensure data is always available.</span></span>

## <a name="metadata-resilience"></a><span data-ttu-id="20b96-126">元数据恢复</span><span class="sxs-lookup"><span data-stu-id="20b96-126">Metadata resilience</span></span>

<span data-ttu-id="20b96-127">SharePoint 元数据对于访问用户内容也至关重要，因为它存储 Azure 存储中存储的内容的位置和访问密钥。</span><span class="sxs-lookup"><span data-stu-id="20b96-127">SharePoint metadata is also critical to accessing user content as it stores the location of and access keys to the content stored in Azure Storage.</span></span> <span data-ttu-id="20b96-128">这些数据库存储在 Azure SQL，其中具有广泛的 [业务连续性计划](/azure/sql-database/sql-database-business-continuity)。</span><span class="sxs-lookup"><span data-stu-id="20b96-128">These databases are stored in Azure SQL, which has an extensive [business continuity plan](/azure/sql-database/sql-database-business-continuity).</span></span>

<span data-ttu-id="20b96-129">SharePoint 使用 Azure SQL 提供的复制模型，并构建了专有自动化技术，以确定需要故障转移并在必要时启动操作。</span><span class="sxs-lookup"><span data-stu-id="20b96-129">SharePoint uses the replication model provided by Azure SQL and has built a proprietary automation technology to determine a failover is required and to initiate the operation if necessary.</span></span> <span data-ttu-id="20b96-130">因此，从 Azure 和 Azure 的角度看，它属于"手动数据库SQL类别。</span><span class="sxs-lookup"><span data-stu-id="20b96-130">As such, it falls into the 'Manual database failover' category from an Azure SQL perspective.</span></span> <span data-ttu-id="20b96-131">Azure 数据库可恢复SQL的最新指标在此处 [提供](/azure/azure-sql/database/business-continuity-high-availability-disaster-recover-hadr-overview#recover-a-database-to-the-existing-server)。</span><span class="sxs-lookup"><span data-stu-id="20b96-131">The latest metrics for Azure SQL database recoverability are available [here](/azure/azure-sql/database/business-continuity-high-availability-disaster-recover-hadr-overview#recover-a-database-to-the-existing-server).</span></span>

![元数据恢复](../media/assurance-metadata-resiliency-diagram.png)

<span data-ttu-id="20b96-133">SharePoint 使用 Azure SQL 备份系统在 PITR (时间点还原) 最多 14 天。</span><span class="sxs-lookup"><span data-stu-id="20b96-133">SharePoint uses Azure SQL's backup system to enable Point in Time Restores (PITR) for up to 14 days.</span></span> <span data-ttu-id="20b96-134">将稍后部分对 PITR [进行更多介绍。](#deletion-backup-and-point-in-time-restore)</span><span class="sxs-lookup"><span data-stu-id="20b96-134">PITR is covered more in a [later section.](#deletion-backup-and-point-in-time-restore)</span></span>

## <a name="automated-failover"></a><span data-ttu-id="20b96-135">自动故障转移</span><span class="sxs-lookup"><span data-stu-id="20b96-135">Automated failover</span></span>

<span data-ttu-id="20b96-136">当发生特定于位置的事件时，SharePoint 使用自定义的自动化故障转移来最大程度地降低对客户体验的影响。</span><span class="sxs-lookup"><span data-stu-id="20b96-136">SharePoint uses a custom-built automated failover to minimize the impact on customer experience when a location-specific event occurs.</span></span> <span data-ttu-id="20b96-137">监控驱动的自动化检测超出特定阈值的单组件或多组件故障将导致所有用户的活动从有问题的环境中自动重定向到温辅助环境。</span><span class="sxs-lookup"><span data-stu-id="20b96-137">Monitoring-driven automation detecting a single or multi-component failure beyond certain thresholds will result in automated redirection of all users' activity out of the problematic environment and over to a warm secondary.</span></span> <span data-ttu-id="20b96-138">故障转移会导致元数据和计算存储完全从新数据中心提供。</span><span class="sxs-lookup"><span data-stu-id="20b96-138">A failover results in metadata and compute storage being served entirely out of the new datacenter.</span></span> <span data-ttu-id="20b96-139">由于 blob 存储始终完全处于活动状态/处于活动状态，因此故障转移不需要任何更改。</span><span class="sxs-lookup"><span data-stu-id="20b96-139">As blob storage always runs entirely active/active, no change is required for a failover.</span></span> <span data-ttu-id="20b96-140">计算层将首选最近的 blob 容器，但将随时使用本地和远程 blob 存储位置以确保可用性。</span><span class="sxs-lookup"><span data-stu-id="20b96-140">The compute tier will prefer the nearest blob container but will use both local and remote blob storage locations at any time to ensure availability.</span></span>

<span data-ttu-id="20b96-141">SharePoint 使用 Azure Front Door 服务提供到 Microsoft 网络内部的路由。</span><span class="sxs-lookup"><span data-stu-id="20b96-141">SharePoint uses the Azure Front Door service to provide routing internal to the Microsoft network.</span></span> <span data-ttu-id="20b96-142">此配置允许独立于 DNS 的故障转移重定向，并减少本地计算机缓存的影响。</span><span class="sxs-lookup"><span data-stu-id="20b96-142">This configuration allows failover redirection independent of DNS and reduces the effect of local-machine caching.</span></span> <span data-ttu-id="20b96-143">大多数故障转移操作对最终用户都是透明的。</span><span class="sxs-lookup"><span data-stu-id="20b96-143">Most failover operations are transparent to end users.</span></span> <span data-ttu-id="20b96-144">如果存在故障转移，则客户无需进行任何更改，即维护对服务的访问权限。</span><span class="sxs-lookup"><span data-stu-id="20b96-144">If there is a failover, customers will not need to make any changes in order to maintain access to the service.</span></span>

## <a name="versioning-and-files-restore"></a><span data-ttu-id="20b96-145">版本控制与文件还原</span><span class="sxs-lookup"><span data-stu-id="20b96-145">Versioning and Files Restore</span></span>

<span data-ttu-id="20b96-146">对于新创建的文档库，SharePoint 默认针对每个文件使用 500 个版本，并可以配置为保留更多版本（如果需要）。</span><span class="sxs-lookup"><span data-stu-id="20b96-146">For newly created document libraries, SharePoint defaults to 500 versions on every file and can be configured to retain more versions if desired.</span></span> <span data-ttu-id="20b96-147">UI 不允许设置少于 100 个版本的值，但可以设置系统以使用公用 API 存储较少的版本。</span><span class="sxs-lookup"><span data-stu-id="20b96-147">The UI doesn't allow a value fewer than 100 versions to be set, but it is possible to set the system to store fewer versions using public APIs.</span></span> <span data-ttu-id="20b96-148">为了可靠性，不建议使用小于 100 的任何值，这可能会导致用户活动导致意外的数据丢失。</span><span class="sxs-lookup"><span data-stu-id="20b96-148">For reliability, any value less than 100 isn't recommended and can result in user activity causing inadvertent data loss.</span></span>

<span data-ttu-id="20b96-149">有关版本控制详细信息，请参阅 [SharePoint 中的版本控制](/microsoft-365/community/versioning-basics-best-practices)。</span><span class="sxs-lookup"><span data-stu-id="20b96-149">For more information about versioning, see [Versioning in SharePoint](/microsoft-365/community/versioning-basics-best-practices).</span></span>

<span data-ttu-id="20b96-150">文件还原是一种功能，在 SharePoint 文档库任何时间恢复为过去 30 天内的任何时间。</span><span class="sxs-lookup"><span data-stu-id="20b96-150">Files Restore is the ability to go 'back in time' on any Document Library in SharePoint to any second of time in the last 30 days.</span></span> <span data-ttu-id="20b96-151">此过程可用于从勒索软件、批量删除、损坏或其他任何事件恢复。</span><span class="sxs-lookup"><span data-stu-id="20b96-151">This process can be used to recover from ransomware, mass deletions, corruption, or any other event.</span></span> <span data-ttu-id="20b96-152">此功能使用文件版本，因此减少默认版本会降低此还原的有效性。</span><span class="sxs-lookup"><span data-stu-id="20b96-152">This feature uses file versions so reducing default versions can reduce the effectiveness of this restore.</span></span>

<span data-ttu-id="20b96-153">OneDrive 和[SharePoint](https://support.office.com/article/Restore-a-document-library-317791c3-8bd0-4dfd-8254-3ca90883d39a)记录了[](https://support.office.com/article/restore-your-onedrive-fa231298-759d-41cf-bcd0-25ac53eb8a15)文件还原功能。</span><span class="sxs-lookup"><span data-stu-id="20b96-153">The Files Restore feature is documented for both [OneDrive](https://support.office.com/article/restore-your-onedrive-fa231298-759d-41cf-bcd0-25ac53eb8a15) and [SharePoint](https://support.office.com/article/Restore-a-document-library-317791c3-8bd0-4dfd-8254-3ca90883d39a).</span></span>

## <a name="deletion-backup-and-point-in-time-restore"></a><span data-ttu-id="20b96-154">删除、备份和时间点还原</span><span class="sxs-lookup"><span data-stu-id="20b96-154">Deletion, backup, and Point in Time Restore</span></span>

<span data-ttu-id="20b96-155">从 SharePoint 中删除的用户内容将经过以下删除流。</span><span class="sxs-lookup"><span data-stu-id="20b96-155">User content deleted from SharePoint goes through the following deletion flow.</span></span>

<span data-ttu-id="20b96-156">已删除的项目在回收站中保留一段时间。</span><span class="sxs-lookup"><span data-stu-id="20b96-156">Deleted items are retained in recycle bins for a certain period of time.</span></span> <span data-ttu-id="20b96-157">对于 SharePoint，保留时间为 93 天。</span><span class="sxs-lookup"><span data-stu-id="20b96-157">For SharePoint, the retention time is 93 days.</span></span> <span data-ttu-id="20b96-158">从项目的原始位置删除项目时，它将开始。</span><span class="sxs-lookup"><span data-stu-id="20b96-158">It begins when you delete the item from its original location.</span></span> <span data-ttu-id="20b96-159">当您从网站回收站中删除项目时，它会进入 [网站集回收站](https://support.office.com/article/restore-deleted-items-from-the-site-collection-recycle-bin-5fa924ee-16d7-487b-9a0a-021b9062d14b)。</span><span class="sxs-lookup"><span data-stu-id="20b96-159">When you delete the item from the site recycle bin, it goes into the [site collection recycle bin](https://support.office.com/article/restore-deleted-items-from-the-site-collection-recycle-bin-5fa924ee-16d7-487b-9a0a-021b9062d14b).</span></span> <span data-ttu-id="20b96-160">它将在剩余的 93 天内保留，然后永久删除。</span><span class="sxs-lookup"><span data-stu-id="20b96-160">It stays there for the remainder of the 93 days, and then is permanently deleted.</span></span> <span data-ttu-id="20b96-161">有关如何使用回收站的信息，请参阅以下链接：</span><span class="sxs-lookup"><span data-stu-id="20b96-161">More information about how to use the recycle bin is available at these links:</span></span>

- [<span data-ttu-id="20b96-162">还原回收站中的项目</span><span class="sxs-lookup"><span data-stu-id="20b96-162">Restore items in the Recycle Bin</span></span>](https://support.office.com/article/Restore-items-in-the-Recycle-Bin-of-a-SharePoint-site-6df466b6-55f2-4898-8d6e-c0dff851a0be)
- <span data-ttu-id="20b96-163">[从网站集回收站还原已删除的项目](https://support.office.com/article/Restore-deleted-items-from-the-site-collection-recycle-bin-5fa924ee-16d7-487b-9a0a-021b9062d14b)。</span><span class="sxs-lookup"><span data-stu-id="20b96-163">[Restore deleted items from the Site Collection Recycle Bin](https://support.office.com/article/Restore-deleted-items-from-the-site-collection-recycle-bin-5fa924ee-16d7-487b-9a0a-021b9062d14b).</span></span>

<span data-ttu-id="20b96-164">此过程是默认删除流，不会考虑保留策略或标签。</span><span class="sxs-lookup"><span data-stu-id="20b96-164">This process is the default deletion flow and does not take into account retention policies or labels.</span></span> <span data-ttu-id="20b96-165">有关详细信息，请参阅了解 [SharePoint 和 OneDrive 的保留](/microsoft-365/compliance/retention-policies-sharepoint)。</span><span class="sxs-lookup"><span data-stu-id="20b96-165">For more information, see [Learn about retention for SharePoint and OneDrive](/microsoft-365/compliance/retention-policies-sharepoint).</span></span>

<span data-ttu-id="20b96-166">完成 93 天的回收管道后，将针对元数据和 Blob 存储独立执行删除。</span><span class="sxs-lookup"><span data-stu-id="20b96-166">After the 93-day recycle pipeline is complete, deletion takes place independently for Metadata and for Blob Storage.</span></span> <span data-ttu-id="20b96-167">将立即从数据库中删除元数据，这使得内容不可读，除非从备份中还原元数据。</span><span class="sxs-lookup"><span data-stu-id="20b96-167">Metadata will be removed immediately from the database, which makes the content unreadable unless the metadata is restored from backup.</span></span> <span data-ttu-id="20b96-168">SharePoint 维护了 14 天的元数据备份。</span><span class="sxs-lookup"><span data-stu-id="20b96-168">SharePoint maintains 14 days-worth of backups of metadata.</span></span> <span data-ttu-id="20b96-169">根据此发布时的文档，这些备份以近实时状态本地进行，然后推送到冗余 Azure 存储[](/azure/sql-database/sql-database-automated-backups)容器中的存储，计划为 5-10 分钟。</span><span class="sxs-lookup"><span data-stu-id="20b96-169">These backups are taken locally in near real time and then pushed to storage in redundant Azure Storage containers on, [according to documentation](/azure/sql-database/sql-database-automated-backups) at the time of this publication, a 5-10-minute schedule.</span></span>

<span data-ttu-id="20b96-170">删除 Blob 存储内容时，SharePoint 会利用 Azure Blob 存储的软删除功能防止意外或恶意删除。</span><span class="sxs-lookup"><span data-stu-id="20b96-170">When deleting Blob Storage content, SharePoint utilizes the soft delete feature for Azure Blob Storage to protect against accidental or malicious deletion.</span></span> <span data-ttu-id="20b96-171">使用此功能，我们总共有 14 天的时间在内容被永久删除之前还原内容。</span><span class="sxs-lookup"><span data-stu-id="20b96-171">Using this feature, we have a total of 14 days in which to restore content before it is permanently deleted.</span></span>

>[!Note]
><span data-ttu-id="20b96-172">虽然 Microsoft 应用程序将内容发送到标准进程的回收站，但 SharePoint 确实提供了允许跳过回收站并强制立即删除的 API。</span><span class="sxs-lookup"><span data-stu-id="20b96-172">While Microsoft applications will send content to the recycle bin for the standard process, SharePoint does provide APIs that allow for skipping the recycle bin and forcing an immediate delete.</span></span> <span data-ttu-id="20b96-173">检查应用程序以确保仅在出于合规性原因需要时完成此操作。</span><span class="sxs-lookup"><span data-stu-id="20b96-173">Review your applications to ensure this is only done when necessary for compliance reasons.</span></span>

## <a name="integrity-checks"></a><span data-ttu-id="20b96-174">完整性检查</span><span class="sxs-lookup"><span data-stu-id="20b96-174">Integrity Checks</span></span>

<span data-ttu-id="20b96-175">SharePoint 使用各种方法来确保数据生命周期所有阶段 blob 和元数据的完整性：</span><span class="sxs-lookup"><span data-stu-id="20b96-175">SharePoint uses various methods to ensure the integrity of blobs and metadata at all stages of the data lifecycle:</span></span>

- <span data-ttu-id="20b96-176">**存储在元数据中的** 文件哈希：整个文件的哈希与文件元数据一起存储，以确保在所有操作过程中保持文档级别数据完整性</span><span class="sxs-lookup"><span data-stu-id="20b96-176">**File hash stored in metadata**: Hash of the entire file is stored with file metadata to ensure document level data integrity is maintained during all operations</span></span>
- <span data-ttu-id="20b96-177">**存储在元数据中的 Blob** 哈希：每个 blob 项存储加密内容的哈希，以防范基础 Azure 存储中的损坏。</span><span class="sxs-lookup"><span data-stu-id="20b96-177">**Blob hash stored in metadata**: Each blob-item stores a hash of the encrypted content to protect against corruption in underlying Azure storage.</span></span>
- <span data-ttu-id="20b96-178">**数据完整性作业**：每 14 天，通过列出数据库中的项目，并匹配 Azure 存储中所列 blob 来扫描每个网站的完整性。</span><span class="sxs-lookup"><span data-stu-id="20b96-178">**Data integrity job**: Every 14 days, each site is scanned for integrity by listing items in the database and matching those up with listed blobs in Azure storage.</span></span> <span data-ttu-id="20b96-179">作业报告任何缺少存储 blob 的 blob 引用，并在需要时通过 Azure 存储 [软删除](/azure/storage/blobs/soft-delete-blob-overview) 功能检索这些 blob。</span><span class="sxs-lookup"><span data-stu-id="20b96-179">The job reports any blob-references missing storage-blobs and can retrieve those blobs through the [Azure storage soft-delete](/azure/storage/blobs/soft-delete-blob-overview) feature if needed.</span></span>
