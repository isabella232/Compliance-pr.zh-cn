---
title: Exchange Online数据恢复能力Microsoft 365
description: 本文将介绍数据恢复能力在Exchange Online Microsoft 365。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 8952d492c4427d5f4af64a853adaaf15303e8caf
ms.sourcegitcommit: fb379d1110a9a86c7f9bab8c484dc3f4b3dfd6f0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/23/2021
ms.locfileid: "53088631"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="8e0cb-103">Exchange Online数据恢复能力Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="8e0cb-103">Exchange Online data resiliency in Microsoft 365</span></span>

>[!IMPORTANT]
><span data-ttu-id="8e0cb-104">随着我们将继续以不同方式投资来保留邮箱内容，我们宣布停用 Exchange 管理中心 (EAC) Exchange Online 中的 In-Place 保留。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-104">As we continue to invest in different ways to preserve mailbox content, we're announcing the retirement of In-Place Holds in the Exchange admin center (EAC) in Exchange Online.</span></span> <span data-ttu-id="8e0cb-105">从 2020 年 7 月 1 日开始，将无法创建新的保留In-Place保留。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-105">Starting July 1, 2020, you won't be able to create new In-Place Holds.</span></span> <span data-ttu-id="8e0cb-106">但你仍然可以在 EAC 中In-Place或通过使用 PowerShell 中的 **Set-MailboxSearch** cmdlet 管理Exchange Online保留。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-106">But you'll still be able to manage In-Place Holds in the EAC or by using the **Set-MailboxSearch** cmdlet in Exchange Online PowerShell.</span></span> <span data-ttu-id="8e0cb-107">但是，从 2020 年 10 月 1 日起，你将无法管理In-Place保留。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-107">However, starting October 1, 2020, you won't be able to manage In-Place Holds.</span></span> <span data-ttu-id="8e0cb-108">只能在 EAC 中或通过使用 **Remove-MailboxSearch** cmdlet 删除它们。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-108">You'll only be able to remove them in the EAC or by using the **Remove-MailboxSearch** cmdlet.</span></span> <span data-ttu-id="8e0cb-109">使用In-Place保留Exchange Server Exchange混合部署仍将受支持。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-109">Using In-Place Holds in Exchange Server and Exchange hybrid deployments will still be supported.</span></span> <span data-ttu-id="8e0cb-110">有关停用旧版电子数据展示In-Place保留Exchange Online，请参阅停用[旧版电子数据展示工具](/microsoft-365/compliance/legacy-ediscovery-retirement)。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-110">For more information about the retirement of In-Place Holds in Exchange Online, see [Retirement of legacy eDiscovery tools](/microsoft-365/compliance/legacy-ediscovery-retirement).</span></span>

<span data-ttu-id="8e0cb-111">就地保留将保留所有邮箱内容，包括已删除项目和已修改项目的原始版本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-111">An In-Place Hold preserves all mailbox content, including deleted items and original versions of modified items.</span></span> <span data-ttu-id="8e0cb-112">所有此类邮箱项目均会返回到[就地电子数据展示](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery)搜索中。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-112">All such mailbox items are returned in an [In-Place eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery) search.</span></span> <span data-ttu-id="8e0cb-113">当您将 In-Place 置于用户邮箱上时，相应的存档邮箱 (中的内容（如果已启用) ）也会置于保留状态，并返回到电子数据展示搜索中。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-113">When you place an In-Place Hold on a user's mailbox, the contents in the corresponding archive mailbox (if it's enabled) are also placed on hold and returned in an eDiscovery search.</span></span>

<span data-ttu-id="8e0cb-114">有两种类型的损坏会影响 Exchange 数据库：物理损坏（通常是由硬件 (导致，特别是存储硬件) 问题）和逻辑损坏（由其他因素导致）。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-114">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="8e0cb-115">通常，在数据库内可能发生两种类型的逻辑损坏Exchange损坏：</span><span class="sxs-lookup"><span data-stu-id="8e0cb-115">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span>

- <span data-ttu-id="8e0cb-116">**数据库逻辑损坏** - 数据库页校验和匹配，但页面上的数据逻辑错误。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-116">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="8e0cb-117">当数据库引擎 (可扩展 存储 引擎 (ESE) ) 尝试写入数据库页时，可能会发生这种情况，即使操作系统返回成功消息，数据也永远不会写入磁盘或写入错误的位置。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-117">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="8e0cb-118">这称为丢失 *刷新*。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-118">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="8e0cb-119">ESE 包括许多旨在防止数据库和其他数据丢失情况的物理损坏的功能和安全措施。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-119">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="8e0cb-120">为了防止丢失刷新丢失数据，ESE 在数据库中包括丢失刷新检测机制，以及一个功能 (单个页面还原) 进行更正。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-120">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span>
- <span data-ttu-id="8e0cb-121">**存储逻辑** 损坏 - 以用户不想的方式添加、删除或操作数据。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-121">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="8e0cb-122">这些情况由第三方应用程序导致。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-122">These cases are caused by third-party applications.</span></span> <span data-ttu-id="8e0cb-123">从用户认为损坏的意义上来说，它通常是损坏的。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-123">It's usually corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="8e0cb-124">Exchange 存储会考虑产生一系列有效 MAPI 操作的逻辑损坏的事务。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-124">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="8e0cb-125">Exchange Online[中的](/exchange/security-and-compliance/create-or-remove-in-place-holds)就地保留功能可防止存储逻辑损坏 (因为它可以防止用户或应用程序用户或应用程序) 。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-125">The [In-Place Hold](/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="8e0cb-126">Exchange Online在日志检查和日志重播期间对复制的日志文件执行几个一致性检查。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-126">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="8e0cb-127">这些一致性检查可防止系统复制物理损坏。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-127">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="8e0cb-128">例如，在日志检查期间，存在一个物理完整性检查，用于验证 日志文件并验证记录在 日志文件 中的校验和是否与内存中生成的校验和匹配。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-128">For example, during log inspection, there is a physical integrity check that verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="8e0cb-129">此外，检查日志文件标头以确保日志标头日志文件记录的内容签名与记录日志日志文件。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-129">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="8e0cb-130">在日志重播期间，日志文件进一步审查。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-130">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="8e0cb-131">例如，数据库标头还包含日志签名，该日志签名与日志文件签名进行比较以确保它们相匹配。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-131">For example, the database header also contains the log signature that is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="8e0cb-132">通过使用 Exchange Native Data Protection（一种复原策略，利用跨多个服务器和多个数据中心的应用程序级复制以及其他功能来帮助防止由于损坏或其他原因丢失数据）在 Exchange Online 中防止邮箱数据的损坏。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-132">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="8e0cb-133">这些功能包括由 Microsoft 或应用程序本身Exchange Online本机功能，例如：</span><span class="sxs-lookup"><span data-stu-id="8e0cb-133">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="8e0cb-134">数据可用性组</span><span class="sxs-lookup"><span data-stu-id="8e0cb-134">Data Availability Groups</span></span>](/exchange/back-up-email)
- <span data-ttu-id="8e0cb-135">单位更正</span><span class="sxs-lookup"><span data-stu-id="8e0cb-135">Single Bit Correction</span></span> 
- <span data-ttu-id="8e0cb-136">联机数据库扫描</span><span class="sxs-lookup"><span data-stu-id="8e0cb-136">Online Database Scanning</span></span> 
- <span data-ttu-id="8e0cb-137">丢失刷新检测</span><span class="sxs-lookup"><span data-stu-id="8e0cb-137">Lost Flush Detection</span></span> 
- <span data-ttu-id="8e0cb-138">单页还原</span><span class="sxs-lookup"><span data-stu-id="8e0cb-138">Single Page Restore</span></span> 
- <span data-ttu-id="8e0cb-139">邮箱复制服务</span><span class="sxs-lookup"><span data-stu-id="8e0cb-139">Mailbox Replication Service</span></span> 
- <span data-ttu-id="8e0cb-140">日志文件检查</span><span class="sxs-lookup"><span data-stu-id="8e0cb-140">Log File Checks</span></span> 
- <span data-ttu-id="8e0cb-141">在复原文件系统上部署</span><span class="sxs-lookup"><span data-stu-id="8e0cb-141">Deployment on Resilient File System</span></span> 

<span data-ttu-id="8e0cb-142">有关前面列出的本机功能的详细信息，请选择超链接，并查看以下内容，了解其他信息以及没有超链接的项目的详细信息。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-142">For more information on the native features listed previously, select the hyperlinks, and see the following for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="8e0cb-143">除了这些本机功能，Exchange Online还包括客户可以管理的数据复原功能，例如：</span><span class="sxs-lookup"><span data-stu-id="8e0cb-143">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="8e0cb-144">默认情况下启用 (项目恢复) </span><span class="sxs-lookup"><span data-stu-id="8e0cb-144">Single Item Recovery (enabled by default)</span></span>](/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="8e0cb-145">就地保留和诉讼保留</span><span class="sxs-lookup"><span data-stu-id="8e0cb-145">In-Place Hold and Litigation Hold</span></span>](/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="8e0cb-146">已删除邮件保留Soft-Deleted邮箱 (都默认启用) </span><span class="sxs-lookup"><span data-stu-id="8e0cb-146">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="8e0cb-147">数据库可用性组</span><span class="sxs-lookup"><span data-stu-id="8e0cb-147">Database Availability Groups</span></span> 
<span data-ttu-id="8e0cb-148">每个邮箱数据库Microsoft 365 [DAG](/exchange/back-up-email) (数据库可用性组中) 复制到同一区域内地理位置不同的数据中心。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-148">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](/exchange/back-up-email) and replicated to geographically separate datacenters within the same region.</span></span> <span data-ttu-id="8e0cb-149">最常见的配置是四个数据中心中的四个数据库副本;但是，一些区域的数据中心 (数据库复制到印度三个数据中心，而澳大利亚和日本有两个数据中心) 。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-149">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="8e0cb-150">但所有情况下，每个邮箱数据库都有四个副本分布在多个数据中心，从而确保邮箱数据免受软件、硬件甚至数据中心故障的影响。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-150">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="8e0cb-151">这四个副本中，其中三个副本配置为高度可用。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-151">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="8e0cb-152">第四个副本配置为滞后 [数据库副本](/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-152">The fourth copy is configured as a [lagged database copy](/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="8e0cb-153">滞后的数据库副本不用于单个邮箱恢复或邮箱项目恢复。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-153">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="8e0cb-154">它的目的是为系统范围内的灾难性逻辑损坏的罕见事件提供恢复机制。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-154">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="8e0cb-155">延迟数据库副本Exchange Online重播延迟时间配置为七日志文件延迟时间。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-155">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="8e0cb-156">此外，Exchange重播延迟管理器为滞后副本提供动态 日志文件 减少功能，以允许滞后数据库副本自行修复和管理日志文件增长。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-156">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="8e0cb-157">尽管滞后数据库副本用于Exchange Online，但必须了解它们不是有保证的时间点备份。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-157">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="8e0cb-158">Exchange Online 中的滞后数据库副本具有可用性阈值，通常约为 90%，因为包含滞后副本的磁盘因磁盘故障而丢失，滞后副本由于自动减少) 而变为高度可用的副本 (，以及滞后数据库副本重建日志重播队列的时间段。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-158">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly available copy (due to automatic play down), as well as the periods where the lagged database copy is rebuilding the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="8e0cb-159">传输恢复能力</span><span class="sxs-lookup"><span data-stu-id="8e0cb-159">Transport Resilience</span></span> 
<span data-ttu-id="8e0cb-160">Exchange Online两个主要传输恢复功能：卷影冗余和安全网络。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-160">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="8e0cb-161">卷影冗余在邮件传输过程中保留邮件的冗余副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-161">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="8e0cb-162">安全网络在邮件成功传递后保留邮件的冗余副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-162">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="8e0cb-163">使用卷影冗余，Exchange Online服务器在确认成功将邮件接收到发送服务器之前，会复制它接收的每封邮件。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-163">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="8e0cb-164">这会使传输管道中所有邮件在传输过程中冗余。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-164">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="8e0cb-165">如果Exchange Online确定原始邮件在传输过程中丢失，则重新传递邮件的冗余副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-165">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="8e0cb-166">Safety Net 是一个与邮箱服务器上传输服务关联的传输队列。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-166">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="8e0cb-167">此队列存储服务器已成功处理的邮件的副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-167">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="8e0cb-168">当邮箱数据库或服务器故障需要激活邮箱数据库的过期副本时，安全网络队列中的邮件将自动重新提交到邮箱数据库的新主动副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-168">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="8e0cb-169">Safety Net 也是冗余的，因此无需将传输作为单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-169">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="8e0cb-170">它使用 Primary Safety Net 和 Shadow Safety Net 的概念，其中，如果 Primary Safety Net 不可用的时间超过 12 小时，重新提交请求将成为卷影重新提交请求，并且从 Shadow Safety Net 重新传递邮件。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-170">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are redelivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="8e0cb-171">从 Safety Net 重新提交邮件由管理 DAG 和邮箱数据库副本的 Microsoft Exchange 复制服务的 Active Manager 组件自动启动。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-171">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="8e0cb-172">从 Safety Net 重新提交邮件不需要手动操作。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-172">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="8e0cb-173">单位更正</span><span class="sxs-lookup"><span data-stu-id="8e0cb-173">Single Bit Correction</span></span> 
<span data-ttu-id="8e0cb-174">ESE 包括一种检测和解决单位 CRC 错误 (也称为单位翻转) ，这是硬件错误 (因此它们表示物理损坏) 。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-174">ESE includes a mechanism to detect and resolve single-bit CRC errors (also known as single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="8e0cb-175">出现这些错误时，ESE 会自动更正错误，并记录事件日志中的事件。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-175">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="8e0cb-176">联机数据库扫描</span><span class="sxs-lookup"><span data-stu-id="8e0cb-176">Online Database Scanning</span></span> 
<span data-ttu-id="8e0cb-177">联机数据库 (也称为数据库检查求 *和)* ESE 使用数据库一致性检查器读取每个页面并检查页面损坏的过程。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-177">Online database scanning (also known as *database check summing*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="8e0cb-178">主要用途是检测事务操作可能未检测到的物理损坏和丢失刷新。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-178">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="8e0cb-179">数据库扫描还执行存储后崩溃操作。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-179">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="8e0cb-180">空间可能会由于崩溃而泄露，联机数据库扫描可查找和恢复丢失的空间。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-180">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="8e0cb-181">系统的设计预期是每七天完全扫描一次每个数据库。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-181">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="8e0cb-182">丢失刷新检测</span><span class="sxs-lookup"><span data-stu-id="8e0cb-182">Lost Flush Detection</span></span> 
<span data-ttu-id="8e0cb-183">如果返回为已完成的磁盘子系统/操作系统的数据库写入操作实际上未写入磁盘或写入错误的位置，则会发生丢失刷新。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-183">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="8e0cb-184">丢失刷新事件可能导致数据库逻辑损坏，因此为了防止丢失刷新导致数据丢失，ESE 包括丢失刷新检测机制。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-184">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="8e0cb-185">当数据库页面写入被动副本时，将检查主动副本上的丢失刷新。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-185">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="8e0cb-186">如果检测到丢失刷新，ESE 可以使用页面修补过程修复进程。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-186">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="8e0cb-187">单页还原</span><span class="sxs-lookup"><span data-stu-id="8e0cb-187">Single Page Restore</span></span> 
<span data-ttu-id="8e0cb-188">单页还原（也称为页面修补）是一个自动过程，其中损坏的数据库页面替换为正常副本中的正常副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-188">Single page restore, also known as *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="8e0cb-189">损坏页面的修复过程取决于数据库副本是主动还是被动。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-189">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="8e0cb-190">当活动数据库副本遇到损坏的页面时，它可以从其中一个副本复制页面，只要它复制的页面是最新的。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-190">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is up to date.</span></span> <span data-ttu-id="8e0cb-191">此过程通过将页面请求放入日志流（这是邮箱数据库复制的基础）完成。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-191">This process is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="8e0cb-192">副本一旦遇到页面请求，就会通过向请求的数据库副本发送页面副本来做出响应。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-192">As soon as a replica encounters the page request, it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="8e0cb-193">单页还原还为活动提供从副本请求页面的异步通信机制，即使副本当前处于脱机状态也是如此。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-193">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="8e0cb-194">如果被动数据库副本（包括滞后数据库副本）损坏，由于这些副本始终位于主动副本之后，因此始终可以安全地将任何页面从主动副本复制到被动副本。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-194">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="8e0cb-195">被动数据库副本本质上是高度可用的，因此在页面修补过程中，日志重播将暂停，但日志复制将继续。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-195">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="8e0cb-196">被动数据库副本从主动副本检索损坏页面的副本，等待复制并检查满足最大所需日志生成要求的 日志文件，然后修补损坏的页面。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-196">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file that meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="8e0cb-197">修复页面后，日志重播恢复。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-197">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="8e0cb-198">对于滞后数据库副本，此过程是相同的，只是滞后数据库首先重播实现可修补状态所需的所有日志文件。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-198">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="8e0cb-199">邮箱复制服务</span><span class="sxs-lookup"><span data-stu-id="8e0cb-199">Mailbox Replication Service</span></span> 
<span data-ttu-id="8e0cb-200">移动邮箱是管理大型电子邮件服务的关键部分。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-200">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="8e0cb-201">始终有更新的技术、硬件和版本升级要处理，因此，具有稳固的受限系统，我们的工程师可以在保持邮箱对用户 (透明移动的同时，确保在整个过程中保持联机状态) 是关键，并确保当邮箱不断变大时，此过程可以正常扩展。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-201">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="8e0cb-202">THE Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span><span class="sxs-lookup"><span data-stu-id="8e0cb-202">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="8e0cb-203">在移动过程中，MRS 对邮箱内的所有项目执行一致性检查。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-203">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="8e0cb-204">如果发现一致性问题，MRS 将更正该问题，或跳过损坏的项目，从而从邮箱中删除损坏。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-204">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="8e0cb-205">由于 MRS 是 Exchange Online的组件，因此我们可以更改其代码，以解决将来检测到的新的损坏形式。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-205">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="8e0cb-206">例如，如果我们检测到 MRS 无法修复的一致性问题，我们可以分析损坏、更改 MRS 代码并更正不一 (如果我们知道如何修复) 。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-206">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="8e0cb-207">日志文件检查</span><span class="sxs-lookup"><span data-stu-id="8e0cb-207">Log File Checks</span></span> 
<span data-ttu-id="8e0cb-208">由数据库生成的所有事务日志文件Exchange进行多种形式的一致性检查。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-208">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="8e0cb-209">创建日志文件时，首先会编写位模式，然后执行一系列日志写入。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-209">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="8e0cb-210">此结构Exchange Online执行一系列检查 (丢失刷新、CRC 和其他检查) 以在写入时验证每个 日志文件，在复制时再次进行验证。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-210">This structure enables Exchange Online to execute a series of checks (lost flush, CRC, and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="8e0cb-211">在复原文件系统上部署</span><span class="sxs-lookup"><span data-stu-id="8e0cb-211">Deployment on Resilient File System</span></span> 
<span data-ttu-id="8e0cb-212">为了帮助防止在文件系统级别发生损坏，Exchange Online正在复原文件系统 (ReFS) 分区上部署，以提供改进的恢复功能。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-212">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="8e0cb-213">ReFS 是 Windows Server 2012 及更高版本中的文件系统，旨在更能够抵御数据损坏，从而最大限度地提高数据可用性和完整性。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-213">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="8e0cb-214">具体来说，ReFS 在元数据更新方式方面进行了改进，从而更好地保护数据并减少数据损坏情况。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-214">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="8e0cb-215">它还使用校验和来验证文件数据和元数据的完整性，以确保可以轻松找到并修复数据损坏。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-215">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="8e0cb-216">Exchange Online多个 ReFS 优势：</span><span class="sxs-lookup"><span data-stu-id="8e0cb-216">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="8e0cb-217">数据完整性的复原性提高意味着数据损坏事件更少。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-217">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="8e0cb-218">减少损坏事件数意味着减少了不必要的数据库重新种数。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-218">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="8e0cb-219">在元数据上运行的校验和可以更快、更确定地检测损坏情况，从而允许我们在数据卷上出现灰色故障之前修复客户数据损坏。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-219">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="8e0cb-220">设计用于大型数据集（千兆字节和更大）而不会影响性能</span><span class="sxs-lookup"><span data-stu-id="8e0cb-220">Designed to work well with large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="8e0cb-221">支持设备使用的其他Exchange Online，如 BitLocker 加密。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-221">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="8e0cb-222">Exchange Online ReFS 功能也可从中获益：</span><span class="sxs-lookup"><span data-stu-id="8e0cb-222">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="8e0cb-223">**完整性 (流)** - ReFS 以一种保护数据免受通常可能导致数据丢失的常见错误影响的方式存储数据。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-223">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="8e0cb-224">Microsoft 365搜索使用完整性流来帮助进行早期磁盘损坏检测和文件内容的校验和。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-224">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="8e0cb-225">当写入操作由于断电等原因 (写入操作完成时，该功能还可以减少"写入"操作导致的损坏) 。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-225">The feature also reduces corruption incidents caused by 'Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="8e0cb-226">**可用性 (Salvage)** - ReFS 优先确定数据的可用性。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-226">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="8e0cb-227">过去，文件系统经常容易发生数据损坏，数据损坏需要使系统脱机进行修复。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-227">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="8e0cb-228">尽管很少见，但如果确实发生损坏，ReFS 会实施回收，这是一项功能，用于从活动卷上的命名空间中删除损坏的数据，并确保良好的数据不受不可修复的损坏数据负面影响。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-228">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="8e0cb-229">将"回收"功能并隔离数据损坏Exchange Online数据库卷意味着我们可以在损坏的卷上保持损坏的卷在损坏和修复操作之间的运行状态。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-229">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="8e0cb-230">此结构提高了通常受此类磁盘损坏问题影响的数据库的可用性。</span><span class="sxs-lookup"><span data-stu-id="8e0cb-230">This structure increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 
